spring:
  application:
    name: file-system
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB
      file-size-threshold: 1KB

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5433/file_system_db}
    username: ${SPRING_DATASOURCE_USERNAME:user}
    password: ${SPRING_DATASOURCE_PASSWORD:password}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  flyway:
    enabled: true
    baseline-on-migrate: true
    clean-disabled: true

server:
  port: ${SERVER_PORT:8080}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true


  metrics:
    export:
      statsd:
        enabled: ${DD_ENABLE_METRICS:false}
        flavor: datadog
        host: ${DD_AGENT_HOST:127.0.0.1}
        port: ${DD_DOGSTATSD_PORT:8125}
    tags:
      application: ${spring.application.name}
      service: ${DD_SERVICE:file-system-app}
      env: ${DD_ENV:dev}
      version: ${DD_VERSION:1.0.0}
    distribution:
      percentiles-histogram:
        http.server.requests: true

aws:
  region: ${AWS_REGION:us-east-1}
  s3:
    bucket-name: ${AWS_S3_BUCKET:filesystem-s3}
    presign-ttl-minutes: ${AWS_S3_PRESIGN_TTL_MINUTES:5}

security:
  jwt:
    # Keep quoted to avoid YAML parsing issues; default is a valid base64 key
    secret: "${SECURITY_JWT_SECRET:IkZTI0VwjSvZuMo99cXAx9xzeJhKHLyJODC5PoHsjO4=}"
    expiration-ms: ${SECURITY_JWT_EXPIRATION_MS:86400000}
    issuer: ${JWT_ISSUER:file-system}
    clock-skew-seconds: ${SECURITY_JWT_CLOCK_SKEW_SECONDS:30}
  ratelimit:
    per-minute:
      upload: 10
      download: 120
      login: 10
    message: "Please slow down"
    send-retry-after: true
    retry-after: 30s
  cors:
    allowed-origins:
      - http://localhost:3000
      - http://127.0.0.1:3000
    allowed-headers:
      - Authorization
      - Content-Type
      - X-Request-ID
      - Accept
    exposed-headers:
      - X-Request-ID
      - Content-Disposition
      - Location